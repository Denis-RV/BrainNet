# Привилегии
*Need to know:* [[1.6 Продвинутые приемы с клавиатурой]]
*status:* Ready
*format:* flow
*tegs:* #linux #programming

---

## Команды для управления правами и привилегиями
```bash
$ id #выводит информацию об идентичности пользователя
$ chmod # изменяет режим доступа к файлу
$ umask #определяет разрешения доступа к файлам по умолчанию
$ su #запускает командную оболочку от имени другого пользователя
$ sudo #выполняет команду от имени другого пользователя
$ chown #изменяет владельца файла
$ chgrp #изменяет группу файла
$ passwd #изменяет пароль пользователя
```

Узнать свои права можно с помощью команды `id`. Если права обычного пользователя, то в доступе к некоторым файлам можно получить отказ. Каждый пользователь может управлять только своими файлами и каталогами и доступом к нему. Пользователя также могут принадлежать группе и получить права доступа для членов группы. Также владелец может определить права доступа для всех остальных.
```bash
$ id
>>>uid=500(me) gid=500(me) groups=500(me)
```
\- user id - идентификатор пользователя, gid - primary group id - идентификатор основной группы.

Вся эта информация хранится в файлах:
- Учетные записи пользователей в /etc/passwd
- информаци о группе в /etc/group

##### Описание вывода команды `ls`:
```bash
$ ls -l foo.txt
>>>-rwxrw-r-- 1 me me 0 2012-03-06 14:52 foo.txt
```
- Типы файлов:![[Pasted image 20210115011801.png]]
- Атрибуты прав доступа:![[Pasted image 20210115152737.png]]![[Pasted image 20210115152749.png]]


#### Команда chmod - изменения режима доступа к фалйу или катлогу.
Изменить права может только владелец. Команда chmod поддерживает два разных способа изменения режима: с использованием восьмеричных чисел и символического представления.

- Режим доступа к файлу в двоичном и восмьеричном представлениях:
	![[Pasted image 20210115044302.png]]
	C помощью трех восмеричных цифр определяется режим доступа к файлам для владельца, группы и остального мира:
	```bash
	$ foo.txt
	$ ls -l foo.txt
	>>>-rw-rw-r-- 1 me me 0 2012-03-06 14:52 foo.txt
	$ chmod 600 foo.txt
	$ ls -l foo.txt
	>>>-rw------- 1 me me 0 2012-03-06 14:52 foo.txt
	```

- Режим доступа к файлу в символьном виде Чтобы указать, для кого устанавливаются разрешения, используется комбинация символов `u`, `g`, `o`:![[Pasted image 20210115044828.png]]
	- u - user, означает владельца файла или каталога
	- g - группа
	- o - other, остальной мир
	- a - all, все три группы.

	Если не указан ни один символ, предполагается all (a). Операцией может быть знак `+`, соответствующий добавлению заданных разрешений, а также знаки `-` и `=`, указывающий, что только заданные разрешения должны быть установлены, а все остальные отобраны. 
	**Разрешения определяются символами `r`,`w`,`x`.**
	
	Примеры символической формы записи прав доступа:![[Pasted image 20210115152934.png]]

	Параметр --recursive воздействует и на файлы, и на каталоги, поэтому он не очень полезен.
	
#### Команда umask - определение доступа разрешений к файлам по умолчанию.
- \- Эта команда определяет разрешения по умолчанию, которые устанавливаюстся для фалйа при его создании. В ней с помощью восьмеричной формы записи определяется битовая маска для сбрасываемх атрибутов режима доступа:
```bash
$ umask
>>>0002
$ > foo.txt
$ ls -l foo.txt
>>> -rw-rw-r-- me me 0 2012-03-06 14:53 foo.txt

$ umask 0000
$ foo2.txt
$ la -l foo2.txt
>>>-rw-rw-rw- 1 me me 0 2012-03-06 14:53 foo2.txt
```

Если развернуть маску в двоичное представление, выйдет так:![[Pasted image 20210115154944.png]]
**Атрибут, соответствующей позиции, где в маске стоит 1, был сброшен.**

##### Специальные разрешения
- Первый атрибут — бит setuid (восьмеричное значение 4000). Устанавливает для процесса не идентификатор реального пользователя, а идентификатор владельца программы. ЧЭто дает возможность программам обращаться к файлам и каталогам,недоступным для обычного пользователя. Очевидно, что из-за возникающих проблем.
- Второй редко используемый атрибут — бит setgid (восьмеричное значение 2000). Устанавливает эффективный идентификатор группы для процесса, выбирая вместо идентификатора группы реального пользователя группу владельца файла. Если установить бит setgid для каталога, вновь создаваемые файлы в этом каталоге будут принадлежать группе владельца каталога, а не группе владельца файла, создавшего его. 
- Третий атрибут называется битом sticky (восьмеричное значение 1000). Linux игнорирует бит sticky у файлов, но если установить его для каталога, он не позволит пользователю удалять или переименовы вать файлы, если только пользователь не является владельцем каталога, владельцемфайла или суперпользователем. 

Примры использования:
```bash 
$ chmod u+s program #установка setuid
# -rwsr-xr-x
$ chmod g+s dir #установка setudid на каталог
# drwxrwsr-x
$ chmod +t dir #установка sticky на каталог
# drwxrwxrwt
```

Каждый файл и каталог, созданный одним членом группы, будет принадлежать основной группе пользователя, а не группе music. Исправить этот недостаток можно установкой бита setgid на каталог.

***Маска umask действует лишь до конца сеанса и сбрасывается по его завершении. Это можно исправить*** #task Добавить ссылку на будующую главу, где будет описано, как это исправить


## Изменение идентичности
Иногда возникает необходимость стать суперпозльователем или превратиться в другого обычного пользователя. Для этого есть три способа:
- Выйти из системы и войти в нвь с учетными данными другого пользователя
- Впспользоваться командой su
- Воспользоваться командой sudo

#### Команда su
Синтаксис команды:
> su [-[l]] [пользователь]

Если указан параметр `-l`, оболочка станет оболочкой входа для указанного пользователя, т.к. будет загружено окружение пользователя и текущим рабочем каталогом станет домашний. Если пользователь не указан, подразу-
мевается суперпользователь. *Эта команда может требовать прав доступа суперпользователя, то есть ее надо вызывать с помощью sudo*.

Символ # в конце вместо символа $ означает привилегии суперпользователя. /root - домашний каталог суперпользователя.

Одно важное отличие между `su` и `sudo` — последняя не запускает новую команд-
ную оболочку и не загружает окружение другого пользователя.

#### Команда chown - имзменене владельца и группы файла.
Синтаксис:
>chown [владелец][:[группа]] файл...

Примеры аргументов команды chown: ![[Pasted image 20210115164317.png]]

Пример, как изменить владельца:
```bash
$ ls -al file.txt
>>>... user user ... file.txt

$ sudo chown root file.txt #изменить владельца
$ ls -al file.txt
>>>... root user ... file.txt

$ sudo chown danis:danis file.txt #изменить владельца и группу
>>>... user user ... file.txt

$sudo chown :root file #изменить группу
>>>... user root ... file.txt
```

## Изменение своего пароля.
Для изменения пароля используестя команда `passwd`:
>sudo passwd [пользователь]

Если вы зашли в командную строку от имени некого пользователя, вы можете изменить пароль этого пользователя, просто написав passwd.