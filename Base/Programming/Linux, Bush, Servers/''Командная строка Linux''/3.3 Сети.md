# Сети
*Need to know:* [[Terms]]
*status:* Ready
*format:* flow
*tegs:* #linux #programming
*description:* В число команд, выбранных для исследования в этой главе, входят команды, ис-
пользуемые для мониторинга сетей и передачи файлов. Дополнительно мы иссле-
дуем программу ssh , используемую для входа в удаленные системы.

---
**Команды:**
```bash
$ ping #посылает пакеты ICMP ECHO_REQUEST узлам в сети.
$ tranceroute #выводит трассировку маршрута пакетов к сетевому узлу
$ netstat #выводит список сетевых соединений, таблицы маршрутов, статистику интерфейсов, маскируемые соединения и сведения о сленстве в широковещательных группах
$ ftp #программа передачи файлов через Интернет
$ lftp #улучшенная ftp
$ wget #неинтерактивный загрузчик файлов из сети
$ ssh #клиент OpenSSH SSH(программа для входа в удаленные системы)
$ scp #программа безопасного копирования файлов через сеть
$ sftp #программа безопасной передачи файлов через сеть
```

#### Команда ping
\- передает специальные пакеты сетевым узлам. Большинство сетевых устройсв принимают эти пакеты и отвечают на них, - это повзоляет проверить сетевые соединения.
Чтобы вопспользоваться командой, необходимо передать ей полной доменное имя. Сразу после запуска программа начианет посылать пакеты с определенным интервалом, пока ее выполнение не будет прервано:
```bash
$ ping linuxcommand.org
>>>PING linuxcommand.org (66.35.250.210) 56(84) bytes of data.
>>>64 bytes from vhost.sourceforge.net (66.35.250.210): icmp_seq=1
7 ms v
>>>64 bytes from vhost.sourceforge.net (66.35.250.210): icmp_seq=2
8 ms ttl=43 time=10
>>>64 bytes from vhost.sourceforge.net (66.35.250.210): icmp_seq=3
6 ms ttl=43 time=10
>>>64 bytes from vhost.sourceforge.net (66.35.250.210): icmp_seq=4
6 ms ttl=43 time=10
>>>64 bytes from vhost.sourceforge.net (66.35.250.210): icmp_seq=5
5 ms ttl=43 time=10
>>>64 bytes from vhost.sourceforge.net (66.35.250.210): icmp_seq=6
7 ms ttl=43 time=10

$ (Ctrl+C)

>>>--- linuxcommand.org ping statistics ---
>>>6 packets transmitted, 6 received, 0% packet loss, time 6010ms
>>>rtt min/avg/max/mdev = 105.647/107.052/108.118/0.824 ms
```

#### Команда traceroute (или tracepath)
\- выводит список всех переходов на пути сетевого трафика между локальной системой и указанным узлом сети.
```bash
traceroute slashdot.org #tracepath slashdot.org
>>>traceroute to slashdot.org (216.34.181.45), 30 hops max, 40 byte packets
>>>1 ipcop.localdomain (192.168.1.1) 1.066 ms 1.366 ms 1.720 ms
>>>2 * * *
```
Здесь можно видеть, что на пути между нашей тестовой системой и http://www.
slashdot.org/ находится 16 маршрутизаторов. Для маршрутизаторов, предостав-
ляющих идентификационную информацию, выводятся имена хостов, IP-адреса
и информация о производительности, которая включает три интервала времени,
понадобившихся для передачи/подтверждения пакетов между локальной систе-
мой и маршрутизатором. Для маршрутизаторов, не предоставляющих идентифи-
кационной информации (например, из-за особенностей настройки маршрутиза-
тора, заторов в сети, действий брандмауэров и т. д.), выводятся звездочки, как это
можно видеть в строке, соответствующей второму переходу.

#### Комада netstat
\- выводит параметры настройки сети ис татистики. Команда имеет множество параметров для просмотра разных аспектов найстройки сети.

Использование параметра -r позволит получить таблицу маршрутизации ядра.
По этой таблице можно судить, как настроена передача пакетов между сетями:
```bash
netstat -r
>>>Kernel IP routing table
Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface
default         _gateway        0.0.0.0         UG        0 0          0 wlp2s0
192.168.100.0   0.0.0.0         255.255.255.0   U         0 0          0 wlp2s0
```
В первой строке демонстрируется адрес назначения 192.168.1.0 . IP-адреса, оканчивающиеся нулем, соответствуют целым сетям, а не отдельным узлам в них, поэтому такой адрес подразумевает: «любой узел в локальной сети». Следующее поле, Gateway (шлюз), определяет имя или IP-адрес шлюза (маршрутизатора) для выхода текущего узла в указанную сеть. Звездочка в этом поле указывает, что использовать шлюз не требуется. В последней строке в качестве адреса назначения указано слово default (по умолчанию). Эта строка управляет трафиком, адресованным любым сетям, не перечисленным в таблице. В данном примере видно, что роль шлюза выполняет маршрутизатор с адресом 192.168.1.1 , который, по всей видимости, знает, что делать с трафиком.

## Передача файлов по сети
#### Протокол FTP (FIle Transfer Protocol)
Этот протокол небезопасен в первоначальном виде, т.к. пересылвает имена и пароли в открытом текством виде, без шифровки, и любой, кто может перехватить сетевой трафик, сможет увидеть их.

В следующем примере показан типичный сеанс работы с программой ftp для
загрузки ISO-образа с дистрибутивом Ubuntu из каталога /pub/cd_images/
Ubuntu-8.04 анонимного сервера FTP fileserver.
![[Pasted image 20210118234355.png]] ![[Pasted image 20210118234422.png]]
Описание используемых команд: ![[Pasted image 20210118234506.png]]

#### Программа wget
\- еще одна популярная программа командной строки для загрузки файлов. Ее удобно использовать для загрузки содержимого веб-сайта.
Большинство параметров, поддерживаемых программой wget , позволяет организовать рекурсивную загрузку, загрузку файлов в фоновом режиме (позволяет выйти из системы без остановки загрузки) и догружать частично загруженные
файлы. Эти возможности хорошо описаны на странице справочного руководства
( man ).

#### Протокол SSH 
Secure Shell - безопасная командная оболочка. SSH подтверждает, что удаленный узел является именно тем, за кого себя выдает, и шифрует все данные, передаваемые между локальным и удаленным узлами.
Большинство дистрибутивов Linux включают реализацию SSH с названием
OpenSSH из проекта BSD.

Пример подключения к удаленному сетевому узлу:
```bash
$ ssh remote-sys
>>>The authenticity of host 'remote-sys (192.168.1.4)' can't be established.
	RSA key fingerprint is 41:ed:7a:df:23:19:bf:3c:a5:17:bc:61:b3:7f:d9:bb.
	Are you sure you want to continue connecting (yes/no)?
$ yes
Warning: Permanently added 'remote-sys,192.168.1.4' (RSA) to the list of known
hosts.
me@remote-sys's password: 
```

Также можно войти в удаленную систему с другим именем:
```bash
sss bob@remote-sys
```

Удаленная система также позволяет выполнить единственную команду:
```bash
ssh remote-sys free
<<<password:
>>>...

#перенаправление вывода команды ls в удаленной 
# системе в локальный файл:
ssh remote-sys 'ls *' > dirlist.txt
#одиночные кавычки предотвращают подстановку пути в 
# локальной системе

#перенаправление в локальный файл удаленной системы:
ssh remote-sys 'ls * > dirlist.txt'
```


#### Запуск программ удаленной системы с графическим интерфейсом
![[Pasted image 20210123131231.png]]

### Безопасная передача данных с помощью `scp` и `sftp`.

Cкопировать документ с именем document.txt из до-
машнего каталога в удаленной системе remote-sys в текущий рабочий каталог в локальной системе можно так:
```bash
[me@linuxbox ~]$ scp remote-sys:document.txt .
me@remote-sys's password:
document.txt 100% 5581 5.5KB/s 00:00
[me@linuxbox ~]$

#если надо изменить имя:
[me@linuxbox ~]$ scp bob@remote-sys:document.txt
```

Команда `sftp` действует аналогично `ftp`, но использует шифрованный тунель SSH. Она не требует, чтобы на удаленном узле работал сервер FTP, ей необходим только сервер SSH. 

Пример сеанса sftp:
```bash
[me@linuxbox ~]$ sftp remote-sys
Connecting to remote-sys...
me@remote-sys's password:
sftp> ls
ubuntu-8.04-desktop-i386.iso
sftp> lcd Desktop
sftp> get ubuntu-8.04-desktop-i386.iso
Fetching /home/me/ubuntu-8.04-desktop-i386.iso to ubuntu-8.04-desktop-i386.iso
/home/me/ubuntu-8.04-desktop-i386.iso 100% 699MB 7.4MB/s 01:35
sftp> bye
```

