# Нормализация и нормальные формы. Связи в базах данных.
*Need to know:* [[1. Термины DB и SQL]]
*status:* In process
*format:* stage
*tegs:* #programming #dataBase 
*desckription:*

---
## Термины и цель
**Нормализация** - процесс преобразования отношения бд к виду отвечаещему нормальным формам.

**Нормальная форма** - свойство отношения в реляционной модели данных, характеризующее его с точки зрения избыточности, потенциально приводящей к логически ошибочным результатам выборки или изменения данных. Нормальная форма определяется как совокупность требований, которым должно удовлетворять отношение. Выделяют 8 нормальных форм

**Цель нормализации**
- Нормализация предназначена для приведения структуры БД к минимальной логической избыточности. Эта цель не связана с увеличением производительности работы или уменьшением физического объема данных. 
- Конченая цель - уменьшение потенциальной протиоречивости, хранимой в БД информации.
- Устранение ибыточности происзводиться за счет декомпозиции отношений таким образом, чтобы в каждом отношении хранились только первичные факты.
- Нормализация не всегда полезна, особенно в вебе, где на первую очередь выходят требования производительности запросов и масштабируемости БД. Для таких систем используют NoSQL решения.

**Потенциальный ключ** - в реляционной модели данных - подмножество атбрибутов отношения, удовлетворяющее требованиям уникальности и минимальности (несократимости).

**Уникальность** означает, что нет и не может быть двух кортежей данного отношения, в которых значения этого подмножества атрибутов совпадают(равны)

**Минимальность(несократимость)** означает, что в составе потенциального ключа отсутсвует меньшее подмножество атрибутов, удовлетворяющее условию уникальности. Если из потенциального ключа убрать любой атрибут, он утратит свойство уникальности.

**Primary Key** - первичный ключ, один из потенциальных ключей отношения, выбранный в качествее основного ключа. Критерии выбора первичного ключа:
1. Сохранине уникальности со временем.
2. Имеет наименьший размер хранения данных.
3. Состоит из меньшего числа атрибутов.
Первичный ключ может быть простым/составным, естественным/суррогатным. Суррогатный ключ обладает следующими характеристиками: Неизменяемость (ключ не меняется), Гарантированная уникальность, Гибкость (из-за неинфомративности ключ может быть заменен в любое время), Эффективность (запросы с суррогатными ключами более компактные)
Использование суррогатного ключа (ID):
	![[Pasted image 20210224160551.png]]
	
**Foregin key** - внешний ключ, подмножество атрибутов некоторого отношения, значения которых должны совпадать со значениями первичного ключа второго отношения, для указания информационной целостности всей БД.

## Нормальные формы
- ***Первая нормальная форма.*** Переменная отношения (таблица) находится в первой нормальной форме только тогда, когда в любом допустимом значении отношения каждый его кортеж содержит только одно значение для каждого из атрибутов.

	Исходная ненормализованная таблица:
	![[Pasted image 20210224142759.png]]

	Таблица, приведенная к 1 нормальной форме:
	![[Pasted image 20210224142824.png]]

- ***Вторая нормальная форма.*** Таблица находиться во второй нф тогда, когда она находиться в первой нф и каждый неключевой атрибут полностью зависти от ее потенциального ключа.

	Исходная форма:
	![[Pasted image 20210224152908.png]]
	
	В качестве потенциального ключа выбираем пару <Категория, Название фотографии>, тогда "Дата фотографии", "Размер файла" и "Фотография" зависят от "Категории" и "Названия фотографии", а вот "Дата путешествия" зависит только от Категориии.
	
	Существует функциональная зависимость "Категория" -> "Дата путешествия", в которой левая часть является лишь частью первичного ключа, что нарушает условие полной зависимости и следовательно данное отношение находится не во второй нормальной форме. Пример логической ошибки данных: неккоректная запись при неккоректной Дате путешествия.
	
	Приведение ко 2 нф:
	![[Pasted image 20210224154452.png]]
	
- ***Третья нормальная форма.*** Таблица находится в 3 нф тогда, когда она находится во 2 нф, и отсутсвуют транзитивные функциональные зависимости неключевых атрибутов от ключевых. Использование суррогатных ключей решает проблему второй нф.Использование суррогатных ключей решает проблему 2 нф.

	Исходная таблица:
	![[Pasted image 20210224161622.png]]
	В данном пример таблица находится не в 3 нф, т.к. сущестуют функциональные зависимости: Дата путешествия -> Категория, Категория -> ID, Дата путешествия -> ID.
	
	Приведение к 3 нф:
	![[Pasted image 20210224163251.png]]
	
	Благодаря третьей нормальной форме исключаются ошибки неоднозначного удаления данных (Хотим удалить только фотки или всю категорию).
	
- ***Остальные нормальные формы:***
	![[Pasted image 20210224163805.png]]
	

## Связи между таблицами
- **Один к одному** - одна запись таблици А можеет ссылаться только на одну запись таблицы B. Свяь один к одному ме ализуется когда первичный ключ таблицы А становится внешним ключом к уникальному полю (первичному ключу) таблицы B.
- **Один ко многим** (многие к одному)
- **Один ко многим в одной таблице**
- **Могие ко многим**